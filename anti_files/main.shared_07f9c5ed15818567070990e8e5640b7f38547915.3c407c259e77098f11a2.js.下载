(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1466:function(e,t,n){"use strict";var a=n(34),r=n(1),i=n(99),c=n(3),o=n.n(c),l=n(0),s=n(51),u=n(95),d=n(2),b=n(36),g=n(58),f={LOCAL:{type:"local",name:"上传图片"},EMOTICON:{type:"emoticon",name:"表情包"},PUBLIC:{type:"public",name:"网络素材"},PRIVATE:{type:"private",name:"个人素材"},LATEST:{type:"latest",name:"最近使用"}},h=Object.values(f),p=Object.keys(f).reduce((function(e,t){return Object.assign(Object.assign({},e),{},Object(d.a)({},t,f[t].type))}),{}),m=(Object.keys(f).reduce((function(e,t){return Object.assign(Object.assign({},e),{},Object(d.a)({},f[t].type,f[t].name))}),{}),{ALL:{type:"all",name:"全部"},STATIC:{type:"static",name:"普通图片"},DYNAMIC:{type:"dynamic",name:"动图"}}),j=Object.values(m),O=(Object.keys(m).reduce((function(e,t){return Object.assign(Object.assign({},e),{},Object(d.a)({},t,m[t].type))}),{}),Object.keys(m).reduce((function(e,t){return Object.assign(Object.assign({},e),{},Object(d.a)({},m[t].type,m[t].name))}),{}),["active"]),v=function(e){var t=e.active,n=Object(b.default)(e,O);return Object(r.b)(s.a,Object.assign({as:"button",zaType:"Button",zaText:!0,zaAction:"Unknown",color:"GBK03A",shouldTrackShow:!0,css:function(e){return[{marginRight:"20px",lineHeight:"50px",fontSize:"15px",cursor:"pointer"},t&&{position:"relative",fontWeight:"bold","::after":{position:"absolute",left:"0",bottom:"0",content:"''",display:"block",width:"100%",height:"4px",backgroundColor:e.colors.GBL01A,flexShrink:"0"}}]}},n))},x=function(e){var t=e.tabType,n=e.tabChange,a=e.tabs,i=a?h.filter((function(e){var t=e.type;return a.includes(t)})):h;return Object(r.c)(g.Flex,{alignItems:"center",justifyContent:"space-between",css:function(e){return{height:"50px",padding:"0 20px",boxShadow:"inset 0px -0.5px 0px ".concat(e.colors.GBK09A)}},children:[Object(r.b)(g.Flex,{children:i.map((function(e){return Object(r.b)(v,{active:t===e.type,onClick:function(){n(e.type)},children:e.name},e.type)}))}),Object(r.b)("div",{className:"MaterialLibrary-SearchInputContainer"})]})};x.propTypes={tabType:o.a.string,tabChange:o.a.func};var y=x,I=n(147),C=n(1193),L=n(446),k=n(224),A=n(118),w=n(1526),S=n(1132),T=n(1031),E=n(889);function B(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var z=function(){return new Promise(requestAnimationFrame)},N=function(e,t,n){e({eventType:"Click",action:"Unknown",elementLocation:{type:t,text:n}})},R=function(){return Object(r.b)(g.Box,{color:"GBK02A",width:"96px",css:function(e){return{position:"absolute",left:"4px",bottom:"4px",width:"48px",height:"16px",lineHeight:"16px",textAlign:"center",fontSize:"12px",background:e.colors.GBL05A,color:e.colors.GBK99A,borderRadius:"2px",zIndex:1}},children:"已删除"})},F=function(e){return Object(r.b)(s.a,Object.assign({as:g.Flex,zaType:"Button",zaAction:"Unknown",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",css:{borderRadius:"2px",position:"absolute",lineHeight:"24px"}},e))},G=function(e){var t=e.data,n=e.chooseImage,i=e.deleted,c=e.deleteSingleImage,o=e.imageUrl,u=e.poster,d=e.isPrivate,b=void 0!==d&&d,f=Object(s.l)().trackEvent,h=Object(S.a)(),p=Object(A.imgUrl)(o||(null==t?void 0:t.origin),"100w"),m=function(e){var t=Object(s.l)().trackEvent,n=Object(l.useState)(null),i=B(a.a,n,2),c=i[0],o=i[1],u="error"===c,d="ready"===c,b=function(n){n.stopPropagation(),"loading"!==c&&(o("loading"),N(t,"Button","加载 gif"),Promise.all([Object(A.loadImage)(e),z().then(z)]).then((function(){o("ready")})).catch((function(){o("error")})))};return{isGifReady:d,gifIcon:"loading"===c||d?Object(r.b)(w.b,{className:"MaterialLibrary-GifIcon",onClick:b}):u?Object(r.b)(w.c,{className:"MaterialLibrary-GifIcon",onClick:b}):Object(r.b)(w.a,{className:"MaterialLibrary-GifIcon",onClick:b})}}(p),j=m.isGifReady,O=m.gifIcon,v=j?p:Object(A.imgUrl)(u||(null==t?void 0:t.thumbnail),"100w"),x="dynamic"===t.subtype?v:p;return Object(r.c)(g.Box,{color:"GBK02A",width:b?"96px":"105px",css:[{display:"inline-block",marginBottom:"10px",marginLeft:b?"14px":"5px",verticalAlign:"top",".MaterialLibrary-GifIcon":{position:"absolute",width:"46px",height:"46px",marginLeft:"-23px",marginTop:"-23px",top:"50%",left:"50%",transition:"0.3s ease-out",transitionProperty:"transform, opacity",transform:"scale(1)",transformOrigin:"center",opacity:"1"}},j&&{".MaterialLibrary-GifIcon":{transform:"scale(0.3)",opacity:"0",width:0,height:0,margin:0}}],children:[Object(r.c)(g.Box,{width:b?"96px":"105px",height:b?"96px":"105px",css:function(e){return{borderRadius:"2px",cursor:"pointer",position:"relative",backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.08),"&:hover > .MaterialLibrary-imgListItemHover":{display:"flex",backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.3)}}},onClick:function(){i||(n(t),N(f,"Image","".concat(null!=t&&t.checked?"取消选中图片":"选中图片")))},children:[Object(r.b)(g.Image,{src:x,loading:"lazy",size:"100%",css:Object.assign({position:"absolute",left:0,right:0,objectFit:"cover",borderRadius:"inherit",opacity:i?"0.3":"1"},h)}),Object(r.b)(g.Box,{sx:{color:"GBK99A",border:"2px solid",borderColor:"GBL01A"},css:function(e){return Object.assign({display:null!=t&&t.checked?"flex":"none",position:"absolute",top:"0",left:"0",right:"0",width:"100%",height:"100%",borderRadius:"inherit"},(null==t?void 0:t.checked)&&{backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.3)})},className:"MaterialLibrary-imgListItemHover",children:i?Object(r.b)(F,{zaText:"删除图片",title:"删除",css:function(e){return{bottom:"2px",right:"2px",backgroundColor:e.colors.GBL01A}},onClick:function(e){e.stopPropagation(),c(t)},children:Object(r.b)(E.a,{fill:"currentColor",size:18})}):Object(r.b)(F,{zaType:"Image",zaText:"选中图片",title:"选中图片",onClick:function(e){e.stopPropagation(),n(t)},css:function(e){return{top:"6px",right:"6px",border:"2px solid ".concat(null!=t&&t.checked?e.colors.GBL01A:e.colors.GBK99A),borderRadius:"50%"}}})}),(null==t?void 0:t.checked)&&Object(r.b)(F,{zaType:"Image",zaText:"取消选中图片",title:"取消选中图片",onClick:function(e){e.stopPropagation(),n(t)},css:function(e){return{top:"8px",right:"8px",fontSize:"14px",textAlign:"center",backgroundColor:e.colors.GBL01A,color:e.colors.GBK99A,borderRadius:"50%"}},children:null==t?void 0:t.checkedIndex}),"dynamic"===t.subtype&&O,i&&Object(r.b)(R,{})]}),Object(r.b)(g.Box,{mt:"4px",fontSize:"10px",lineHeight:"20px",css:Object.assign(Object.assign({},Object(T.a)(1)),{},{wordBreak:"break-all"}),title:"文件名称",children:null==t?void 0:t.name})]})};G.propTypes={data:o.a.string,chooseImage:o.a.func,getLatestList:o.a.func};var P=G,M=n(438),D=["children"],_=function(e){return Object(r.b)("i",Object.assign({css:{marginLeft:"14px",width:"96px"}},e))},K=function(e){var t=e.children,n=Object(b.default)(e,D);return Object(r.c)(M.b,Object.assign(Object.assign({css:{display:"flex",flex:1,overflow:"auto",flexWrap:"wrap",justifyContent:"space-between",alignContent:"flex-start",height:"100%",marginLeft:"-5px",padding:"0 20px 0"}},n),{},{children:[t,Object(r.b)(_,{}),Object(r.b)(_,{}),Object(r.b)(_,{}),Object(r.b)(_,{}),Object(r.b)(_,{}),Object(r.b)(_,{})]}))},U=n(918),H=n(50),W=n(144),Z=["onSearch"];function q(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var V=function(e){var t=e.onSearch,n=Object(b.default)(e,Z),i=Object(l.useState)(""),c=q(a.a,i,2),o=c[0],s=c[1],u=Object(l.useState)(null),d=q(a.a,u,2),g=d[0],f=d[1];return Object(l.useEffect)((function(){f(document.querySelector(".MaterialLibrary-SearchInputContainer"))}),[]),g&&Object(H.createPortal)(Object(r.b)(W.a,Object.assign({className:"materials_library_public_search",onChange:function(e){return s(e.target.value)},value:o,after:Object(r.b)(U.a,{text:!0,onClick:function(){t(o)}}),onKeyUp:function(e){13===e.keyCode&&t(o)},css:function(e){return{width:"198px",height:"28px",lineHeight:"28px",fontSize:"12px",color:e.colors.GBL05A,backgroundColor:e.colors.GBK99A,border:"1px solid",borderColor:e.colors.GBK08A}}},n)),g)},J=n(978),Y=["checked","onChange"],$=function(e){var t=e.checked,n=e.onChange,a=Object(b.default)(e,Y);return Object(r.c)(g.Flex,Object.assign(Object.assign({alignItems:"center",css:function(e){return{fontSize:"13px",color:e.colors.GBL04A}}},a),{},{children:[Object(r.b)(J.a,{type:"checkbox",checked:t,onChange:function(e){n(e.target.checked)},size:15,style:{marginRight:"5px",marginTop:"1px"}}),"本页全选"]}))},Q=n(4),X=n(218),ee=n(5),te=Object(l.createContext)({}),ne=function(){return Object(l.useContext)(te)},ae=function(e){var t=e.onClose,n=e.sourceType,a=e.sourceId,i=e.insertImage,c=e.setTabType,o=e.initLocalList,s=e.setInitLocalList,u=e.children,d=e.maxImage;return Object(r.b)(te.Provider,{value:Object(l.useMemo)((function(){return{onClose:t,sourceType:n,sourceId:a,insertImage:i,setTabType:c,initLocalList:o,setInitLocalList:s,maxImage:d}}),[t,n,a,i,c,o,s,d]),children:u})};function re(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var ie=function(e){var t=e.itemKey,n=Object(k.b)(),r=Object(s.l)().trackEvent,c=ne(),o=c.sourceId,u=c.sourceType,d=c.insertImage,b=c.onClose,g=Object(l.useState)([]),f=re(a.a,g,2),h=f[0],p=f[1],m=Object(l.useState)(!0),j=re(a.a,m,2),O=j[0],v=j[1],x=Object(l.useState)(!1),y=re(a.a,x,2),I=y[0],C=y[1],L=Object(l.useState)(!1),A=re(a.a,L,2),w=A[0],S=A[1],T=Object(l.useState)(!1),E=re(a.a,T,2),B=E[0],z=E[1],N=Object(l.useState)("all"),R=re(a.a,N,2),F=R[0],G=R[1],P=Object(l.useState)(null),M=re(a.a,P,2),D=M[0],_=M[1],K=h.length&&h.every((function(e){return e.checked})),U=function(){v(!0),z(!1),S(!1),_(null),p([]),C(!1)},H=Object(i.a)((function(e,t){var n;(v(!1),t)?z(!0):X.a.alert((null==e?void 0:e.message)||(null==e||null===(n=e.error)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧!")})),W=Object(i.a)((function(e){var t,n=Object(ee.camelizeKeys)(e.payload||{});v(!1),S(null==n||null===(t=n.paging)||void 0===t?void 0:t.isEnd),_(null==n?void 0:n.paging),p((function(e){return e.concat((null==n?void 0:n.data)||[])}))})),Z=Object(i.a)((function(e){p((function(n){var a,r=re(Q.a,n),i=r.find((function(n){return e[t]===n[t]})),c=(null==r||null===(a=r.map((function(e){return null==e?void 0:e.checkedIndex})).sort((function(e,t){return t-e})))||void 0===a?void 0:a[0])||0;return i&&(i.checked=!i.checked,i.checked?i.checkedIndex=c+1:(r.forEach((function(e){(null==e?void 0:e.checkedIndex)>i.checkedIndex&&e.checkedIndex--})),delete i.checkedIndex)),r}))})),q=Object(i.a)((function(e){d(e.map((function(e){return e.origin}))),n("".concat(location.origin,"/api/v4/materials/pc_editor/recently-materials"),{method:"POST",body:{source_type:u,source_id:String(o),material_type:"image",material_ids:e.map((function(e){return e.materialId}))}}),b()}));return{materialList:h,setMaterialList:p,paging:D,isLoading:O,setIsLoading:v,hasInited:I,setHasInited:C,isDrained:w,setIsDrained:S,isPageError:B,setIsPageError:z,subTypeCatch:F,setSubTypeCatch:G,selectAllChecked:K,toggleSelectAll:function(e){e&&r({action:"Unknown",eventType:"Click",elementLocation:{type:"Button",text:"本页全选"}}),p((function(t){return t.map((function(t,n){return Object.assign(Object.assign({},t),{},{checked:e,checkedIndex:e?n+1:void 0})}))}))},reset:U,handleSubTypeChange:function(e){I&&e!==F&&(G(e),U())},handleResponseErrorData:H,handleResponseData:W,chooseImage:Z,insertImages:q}},ce=["active"],oe=function(e){return Object(r.b)(g.Flex,Object.assign({justifyContent:"space-between",css:{padding:"10px 20px 10px 8px"}},e))},le=function(e){return Object(r.b)("div",Object.assign(Object.assign({css:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"}},e),{},{children:"加载中..."}))},se=function(e){return Object(r.b)(s.a,Object.assign({as:"button",zaType:"Button",zaText:!0,zaAction:"Unknown",css:{marginRight:"10px",padding:"7px 15px",fontSize:"14px",borderRadius:"3px","&:last-child":{marginRight:0}}},e))},ue=function(e){var t=e.active,n=Object(b.default)(e,ce);return Object(r.b)(se,Object.assign({css:function(e){return[{background:e.colorMod(e.colors.GBL01A).alpha(.3),color:e.colors.GBK99A,"&[disabled]":{opacity:.5,cursor:"default"}},t&&{background:e.colors.GBL01A}]}},n))},de=function(e){return Object(r.b)(se,Object.assign({css:function(e){return{background:e.colors.GBK10A,color:e.colors.GBK03A}}},e))},be=function(e){return Object(r.b)(se,Object.assign({css:function(e){return{background:e.colors.GBK10A,color:e.colors.GRD03A}}},e))},ge=function(e){return Object(r.b)("svg",Object.assign(Object.assign({},e),{},{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(r.b)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C11.4477 0 11 0.447716 11 1V11H1C0.447715 11 0 11.4477 0 12C0 12.5523 0.447716 13 1 13H11V23C11 23.5523 11.4477 24 12 24C12.5523 24 13 23.5523 13 23V13H23C23.5523 13 24 12.5523 24 12C24 11.4477 23.5523 11 23 11H13V1C13 0.447715 12.5523 0 12 0Z",fill:"#999999"})}))},fe=function(e){return null!=e&&e.length?e.sort((function(e,t){return(null==e?void 0:e.checkedIndex)-(null==t?void 0:t.checkedIndex)})):[]},he=["dataList","insertImages"],pe=["keywordCatch"];function me(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var je=function(e){var t=e.isPageError,n=e.keywordCatch,a=e.reset;return t?Object(r.b)(C.a.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:a}):Object(r.b)(C.a.EI1A,{image:"default",content:"没有找到".concat(n?"「"+n+"」":"","相关内容"),buttonText:"搜索其他内容",buttonOnClick:function(){var e;null===(e=document.querySelector(".materials_library_public_search"))||void 0===e||e.focus()}})},Oe=function(e){var t=e.dataList,n=e.insertImages,a=Object(b.default)(e,he),i=(t||[]).filter((function(e){return!0===e.checked}));return Object(r.b)(g.Flex,Object.assign(Object.assign({css:{padding:"13px 20px"},justifyContent:"flex-end"},a),{},{children:Object(r.b)(ue,{active:i.length>0,onClick:function(){n(fe(i))},css:{margin:0},zaText:"插入图片；图片数：".concat(i.length||0),children:"插入图片"})}))},ve=function(e){var t=e.keywordCatch,n=Object(b.default)(e,pe),a=Object(k.b)(),c=ne(),o=c.insertImage,s=c.onClose,u=ie({itemKey:"id"}),d=u.materialList,f=u.paging,h=u.isLoading,p=u.setIsLoading,m=u.hasInited,j=u.setHasInited,O=u.isDrained,v=u.isPageError,x=u.setIsPageError,y=u.selectAllChecked,I=u.toggleSelectAll,C=u.reset,A=u.handleResponseErrorData,w=u.handleResponseData,S=u.chooseImage,T=!d.length,E=Object(i.a)((function(){return p(!0),x(!1),a((null==f?void 0:f.next)||Object(L.a)("".concat(location.origin,"/api/v4/materials/pc_editor/search"),{offset:null==d?void 0:d.length,limit:24,keyword:t||"表情包"}))})),B=Object(i.a)((function(){return E().then(w).catch((function(e){A(e.payload)}))})),z=Object(i.a)((function(e){o(e.map((function(e){return e.origin}))),s()}));Object(l.useEffect)((function(){m||E().then(w).catch((function(e){A(e.payload,!0)})).finally((function(){j(!0)}))}),[m,j,E,w,A]);var N=T?!h&&Object(r.b)(je,{isPageError:v,keywordCatch:t,reset:C}):Object(r.c)(r.a,{children:[Object(r.b)(K,{getContainer:function(e){return e},onLoad:B,isLoading:h,isDrained:O,children:d.map((function(e,t){return Object(r.b)(P,{data:e,insertImages:z,chooseImage:S},String([e.id,t]))}))}),Object(r.b)(Oe,{dataList:d,insertImages:z})]});return Object(r.c)(g.Flex,Object.assign(Object.assign({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},n),{},{children:[Object(r.c)(oe,{children:[Object(r.b)("div",{className:"MaterialLibrary-SearchTipsContainer",children:t&&!T&&!h&&!v&&Object(r.c)(g.Box,{color:"GBK03A",width:"200px",css:{margin:"0px 12px",fontSize:"12px"},children:["以下为「",t,"」相关搜索内容"]})}),Object(r.b)($,{checked:y,onChange:I})]}),m?N:Object(r.b)(le,{})]}))},xe=function(e){var t=Object(I.default)({},e),n=Object(l.useState)(""),i=me(a.a,n,2),c=i[0],o=i[1];return Object(r.c)(r.a,{children:[Object(r.b)(V,{placeholder:"搜索表情包",onSearch:o}),Object(r.b)(ve,Object.assign({keywordCatch:c},t),c)]})},ye=["dataList","deleteImages","insertImages"],Ie=function(e){var t=e.isPageError,n=e.reset,a=ne().setTabType;return t?Object(r.b)(C.a.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:n}):Object(r.b)(C.a.EI1A,{image:"default",content:"最近使用为空，请搜索网络素材或上传图片",buttonText:"上传图片",buttonOnClick:function(){a(p.PRIVATE)}})},Ce=function(e){var t=e.dataList,n=e.deleteImages,a=e.insertImages,i=Object(b.default)(e,ye),c=(t||[]).filter((function(e){return!0===e.checked}));return Object(r.c)(g.Flex,Object.assign(Object.assign({css:{padding:"13px 20px"},justifyContent:c.length>0?"space-between":"flex-end"},i),{},{children:[c.length>0&&Object(r.b)(be,{onClick:function(){0!==c.length&&X.a.confirm(Object(r.c)("div",{className:"MaterialLibrary-alert",children:[Object(r.c)("h2",{children:["是否删除已选择共 ",c.length," 张图片？"]}),Object(r.b)("p",{children:"插入至内容中的图片不会受到影响"})]}),{text:{ok:"删除",cancel:"取消"}}).then((function(){n(c.map((function(e){return e.materialId})))}),(function(){}))},children:"删除图片"}),Object(r.b)(ue,{active:c.length>0,onClick:function(){a(fe(c))},zaText:"插入图片；图片数：".concat(c.length||0),children:"插入图片"})]}))},Le=function(e){var t=Object(I.default)({},e),n=Object(k.b)(),a=ie({itemKey:"materialId"}),c=a.materialList,o=a.paging,s=a.isLoading,u=a.setIsLoading,d=a.hasInited,b=a.setHasInited,f=a.isDrained,h=a.isPageError,p=a.setIsPageError,m=a.selectAllChecked,j=a.toggleSelectAll,O=a.reset,v=a.handleResponseErrorData,x=a.handleResponseData,y=a.chooseImage,C=a.insertImages,A=!c.length,w=Object(i.a)((function(){return u(!0),p(!1),n((null==o?void 0:o.next)||Object(L.a)("".concat(location.origin,"/api/v4/materials/pc_editor/recently-materials"),{offset:null==c?void 0:c.length,limit:24,material_type:"image"}))})),S=Object(i.a)((function(){return w().then(x).catch((function(e){v(e.payload)}))})),T=Object(i.a)((function(e){return n("".concat(location.origin,"/api/v4/materials/pc_editor/recently-materials"),{method:"DELETE",body:{material_type:"image",material_ids:e}}).then((function(e){var t,n;null!==(t=e.payload)&&void 0!==t&&t.success?O():X.a.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")}))})),E=Object(i.a)((function(e){X.a.confirm(Object(r.c)("div",{className:"MaterialLibrary-alert",children:[Object(r.b)("h2",{children:"是否从最近使用删除图片？"}),Object(r.b)("p",{children:"插入至内容中的图片不会受到影响"})]}),{text:{ok:"删除",cancel:"取消"}}).then((function(){T([e.materialId])}),(function(){}))}));Object(l.useEffect)((function(){d||w().then(x).catch((function(e){v(e.payload,!0)})).finally((function(){b(!0)}))}),[d,b,w,x,v]);var B=A?!s&&Object(r.b)(Ie,{isPageError:h,reset:O}):Object(r.c)(r.a,{children:[Object(r.b)(K,{getContainer:function(e){return e},onLoad:S,isLoading:s,isDrained:f,children:c.map((function(e,t){return Object(r.b)(P,{data:e,chooseImage:y,insertImages:C,deleted:e.deleted,deleteSingleImage:E},String([e.materialId,t]))}))}),Object(r.b)(Ce,{dataList:c,deleteImages:T,insertImages:C})]});return Object(r.c)(g.Flex,Object.assign(Object.assign({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},t),{},{children:[Object(r.b)(oe,{children:Object(r.b)($,{css:{marginLeft:"auto"},checked:m,onChange:j})}),d?B:Object(r.b)(le,{})]}))},ke=n(1006),Ae=n(886),we=n(145),Se=n.n(we),Te=n(20),Ee=n(94),Be=n.n(Ee),ze=n(31),Ne=n(291),Re=n(1264),Fe=n(436),Ge=n(902),Pe=function(e){var t,n=e.data,a=e.deleteImage,i=e.reUploadImage,c=e.dragWrapRef,o=n||{},l=o.tag,s=o.index,u=(null==c||null===(t=c.current)||void 0===t?void 0:t.clientWidth)||746,d={cursor:"pointer",userDrag:"none",userSelect:"none",WebkitUserDrag:"none",WebkitUserSelect:"none"};return Object(r.c)(g.Box,{id:l.originSrc+s,css:function(e){return Object.assign({position:"relative",display:"inline-block",width:"105px",height:"105px",margin:"0 calc(".concat(u-655,"px / 12) 15px"),borderRadius:"2px",background:e.colors.GBK10C,"&:active":{filter:"drop-shadow(0px 3px 6px rgba(0, 0, 0, 0.15)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))"}},"pending"===l.status&&d)},children:[Object(r.b)(g.Image,{src:l.originSrc,width:"100%",height:"100%",css:{borderRadius:"2px"},sx:{objectFit:"cover"}}),Object(r.c)(g.Box,{css:function(e){return{position:"absolute",top:0,left:0,width:"105px",height:"105px",borderRadius:"2px",zIndex:2,backgroundColor:e.colorMod(e.colors.GBK02A).alpha("success"===l.status?0:.4),"& .CircleLoadingBar .path":{stroke:e.colors.GBK99A},"&:hover":{".close":{display:"block"}}}},children:["pending"===l.status&&Object(r.b)(Re.a,{}),Object(r.b)(g.Box,{className:"close",css:function(e){return Object.assign({position:"absolute",top:"-10px",right:"-9px",zIndex:3,width:"20px",height:"20px",lineHeight:"21px",fontSize:"15px",textAlign:"center",borderRadius:"50%",display:"none",backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.4),color:e.colors.GBK99A,"&>span":{marginLeft:"1px"}},d)},onClick:function(){return a(l,s)},children:Object(r.b)(Fe.a,{center:!0,width:"13px",height:"13px"})}),"error"===l.status&&Object(r.c)(r.a,{children:[Object(r.c)(g.Flex,{fontSize:"15px",fontWeight:"400",height:"82px",color:"GBK99A",alignItems:"center",justifyContent:"center",css:d,onClick:function(){return i(l.file,s)},children:[Object(r.b)(Ge.a,{width:"20px",height:"22px"}),Object(r.b)(g.Text,{ml:"3px",children:"重试"})]}),Object(r.b)(g.Box,{css:function(e){return{position:"absolute",bottom:0,left:0,zIndex:3,width:"100%",height:"23px",lineHeight:"23px",fontSize:"12px",fontWeight:400,textAlign:"center",backgroundColor:e.colorMod(e.colors.GBK99A).alpha(.8),color:e.colors.GRD03A,borderRadius:"0 0 1px 1px"}},children:"上传失败"})]})]})]},l.originSrc+s)},Me=n(2448),De=function(e){var t=e.handleUploadImage,n=e.content,a=e.style,i=void 0===a?{}:a,c=e.isLocal,o=Object(l.useRef)();return Object(r.c)(r.a,{children:[Object(r.b)("input",{css:{display:"none"},ref:o,type:"file",onChange:function(e){t(e),c&&(o.current.value=null)},accept:"image/*",multiple:!0}),Object(r.b)(s.a,{zaType:"Button",zaText:"本地上传图片",as:g.Flex,role:"button",width:"92px",height:"32px",lineHeight:"32px",fontSize:"12px",color:"GBL05A",alignItems:"center",justifyContent:"center",ml:"19px",mb:"6px",onClick:function(){return o.current.click()},css:function(e){return Object.assign({verticalAlign:"top",display:"inline-flex",cursor:"pointer",borderRadius:"2px",backgroundColor:e.colorMod(e.colors.GBL05A).alpha(.08)},i)},children:n||Object(r.c)(r.a,{children:[Object(r.b)(Me.b,{}),Object(r.b)(g.Text,{ml:"3px",mt:"2px",children:"本地上传"})]})})]})},_e=["handleUploadImage"],Ke=function(e){var t=e.handleUploadImage,n=Object(b.default)(e,_e);return Object(r.b)(g.Flex,Object.assign(Object.assign({},n),{},{height:"100%",alignItems:"center",justifyContent:"center",children:Object(r.c)(g.Box,{textAlign:"center",children:[Object(r.b)(De,{handleUploadImage:t,style:{width:"104px",height:"104px",border:"1px dashed #d3d3d3",margin:0,background:"transparent",borderRadius:"8px","&:hover":{background:"rgba(246, 246, 246, 0.3)"}},content:Object(r.b)(ge,{})}),Object(r.b)(g.Text,{color:"GBK02A",fontSize:"14px",fontWeight:"500",mt:"10px",children:"上传图片"}),Object(r.b)(g.Text,{color:"GBK06A",fontSize:"12px",mt:"4px",children:"支持 JPG、JPEG、PNG 等格式"})]})}))},Ue=["dataList","insertImages","onClose","maxImage"];function He(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var We=function(e){var t=e.src,n=e.originalSrc,a=e.watermarkSrc,r=e.privateWatermarkSrc,i=e.watermark,c=e.dataRawwidth,o=e.dataRawheight,l=e.hash,s=Object(A.imgUrl)(t,{quality:Be()(navigator.userAgent).Mobile?50:80,size:window.devicePixelRatio>=1.5?"1440w":"720w"});return{src:s,url:s,originalSrc:n,watermarkSrc:a,privateWatermarkSrc:r,watermark:i,rawWidth:c,rawHeight:o,id:l}},Ze=function(e){var t=e.dataList,n=e.insertImages,a=e.onClose,i=e.maxImage,c=Object(b.default)(e,Ue),o=!!i&&t.length>i;return Object(r.c)(g.Flex,Object.assign(Object.assign({css:{padding:"13px 20px",position:"relative"},alignItems:"center",justifyContent:"flex-end"},c),{},{children:[i&&(null==t?void 0:t.length)>0&&Object(r.c)(g.Box,{css:{position:"absolute",left:20,top:20,display:"flex"},color:"GBK03A",fontSize:"13px",children:[Object(r.b)(g.Text,{css:{color:o&&"red"},children:t.length}),"/",i,Object(r.c)(g.Text,{css:{opacity:.9,marginLeft:5},children:["(最多上传 ",i," 张图片)"]})]}),(null==t?void 0:t.length)>0&&Object(r.c)(g.Text,{color:"GBK03A",fontSize:"14px",fontWeight:"400",mr:"10px",children:["已上传 ",t.length," 张图片，拖拽可调整顺序"]}),Object(r.b)(ue,{active:t.length>0,onClick:function(){var e=t.map((function(e){return e.data||{}}));n(e,!0),a()},disabled:o,zaText:"插入图片；图片数：".concat(t.length||0),children:"插入图片"})]}))},qe=function(e){var t=e.handleUploadImage,n=e.errorList,a=e.reUpload;return Object(r.c)(g.Flex,{alignItems:"center",justifyContent:"space-between",children:[Object(r.b)(De,{handleUploadImage:t,style:{margin:"5px 0 4px 20px",height:"32px"},isLocal:!0}),(null==n?void 0:n.length)>0&&Object(r.c)(g.Flex,{alignItems:"center",mr:"20px",mt:"1px",fontSize:"14px",children:[Object(r.c)(g.Text,{color:"GRD03A",children:[n.length," 张上传失败"]}),Object(r.b)(g.Text,{css:function(e){return{width:"114px",height:"32px",lineHeight:"32px",marginLeft:"10px",borderRadius:"3px",cursor:"pointer",background:e.colors.GBK10A,color:e.colors.GBL01A,fontWeight:500,textAlign:"center"}},onClick:a,children:"批量重新上传"})]})]})},Ve=function(){var e=(Object(Ae.a)((function(){return Promise.all([n.e(0),n.e(136)]).then(n.t.bind(null,3004,7))}))||{}).DraggableArea,t=Object(l.useRef)(),i=Object(Te.useDispatch)(),c=ne().sourceType,o=ne(),s=o.insertImage,u=o.onClose,d=o.initLocalList,b=o.setInitLocalList,f=o.maxImage,h=Object(l.useState)(d||[]),p=He(a.a,h,2),m=p[0],j=p[1],O=Object(l.useRef)(m);Object(l.useEffect)((function(){O.current=m}),[m]),Object(l.useEffect)((function(){return j(d),function(){var e;b(null===(e=O.current)||void 0===e?void 0:e.map((function(e){return Object.assign(Object.assign({},e),"pending"===e.status&&{status:"error"})})))}}),[]);var v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.findIndex((function(e){return e.id===t})),r=He(Q.a,e);return-1!==a&&r.splice(a,1,Object.assign(Object.assign({},e[a]),n)),r},x=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e){var a=null!=n&&n.isUpload?null==n?void 0:n.imageList:m;a.splice(t,1,Object.assign(Object.assign({},a[t]),{},{status:"pending"})),j((function(){return He(Q.a,a)})),i(Object(Ne.b)(e,"default",c)).then((function(e){var n=e.payload;j((function(e){var r;return v(e,null===(r=a[t])||void 0===r?void 0:r.id,{data:We(n),status:"success"})}))})).catch((function(){j((function(e){var n;return v(e,null===(n=a[t])||void 0===n?void 0:n.id,{status:"error"})}))}))}},y=function(e){var t,n=e.target.files;null!=n&&n.length&&((null==n?void 0:n.length)>100?X.a.alert("添加图片请不要超过 100 张哦~"):null===(t=Array.from(n))||void 0===t||t.forEach((function(e){Object(ke.b)({file:e,preset:ke.a.content}).then((function(){j((function(t){var n=[].concat(He(Q.a,t),[{originSrc:window.URL.createObjectURL(e),status:"pending",id:Se()("image"),file:e}]);return function(e,t){var n=t.length-1;x(t[n].file,n,{isUpload:!0,imageList:t})}(0,n),n}))})).catch((function(e){i(Object(ze.h)(e.message||"图片上传未完成，请稍后发布","red"))}))})))},I=function(e,t){var n=He(Q.a,m);n.splice(t,1),j(n)},C=function(e){var t=[];return null==e||e.forEach((function(e,n){"error"===e.status&&t.push(Object.assign(Object.assign({},e),{},{index:n}))})),t};return null!=m&&m.length?Object(r.c)(r.a,{children:[Object(r.b)(qe,{handleUploadImage:y,errorList:C(m),reUpload:function(){var e;null===(e=C(m))||void 0===e||e.forEach((function(e){return x(e.file,e.index)}))}}),Object(r.b)(g.Box,{ref:t,css:{position:"relative",width:"100%",height:"505px",overflowY:"scroll",padding:"10px 12.5px 16px",lineHeight:"0.8"},children:e?Object(r.b)(e,{tags:m.map((function(e){return Object.assign(Object.assign({},e),{},{id:"".concat(e.id,"_").concat(e.status)})})),render:function(e){return Object(r.b)(Pe,{data:e,deleteImage:I,reUploadImage:x,dragWrapRef:t})},onChange:function(e){j(e.map((function(e){var t,n;return Object.assign(Object.assign({},e),{},{id:(null===(t=e.id)||void 0===t||null===(n=t.split("_"))||void 0===n?void 0:n[0])||Se()("image")})})))}}):m.map((function(e,n){return Object(r.b)(Pe,{data:{tag:e,index:n},deleteImage:I,reUploadImage:x,dragWrapRef:t},"".concat(e.id,"_").concat(n))}))}),Object(r.b)(Ze,{dataList:m.filter((function(e){return"success"===e.status})),onClose:u,insertImages:s,maxImage:f})]}):Object(r.b)(Ke,{css:{marginTop:"-20px"},handleUploadImage:y})},Je=function(e){var t=Object(I.default)({},e);return Object(r.b)(r.a,{children:Object(r.b)(g.Flex,Object.assign(Object.assign({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},t),{},{children:Object(r.b)(Ve,Object.assign({},t))}))})},Ye=n(160),$e=n(302),Qe=n(312);function Xe(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var et=function(e){var t=Object(k.b)(),n=Object(l.useState)({}),r=Xe(a.a,n,2),c=r[0],o=r[1],s=Object(l.useState)(!1),u=Xe(a.a,s,2),d=u[0],b=u[1],g=Object(l.useState)(""),f=Xe(a.a,g,2),h=f[0],p=f[1],m=Object(l.useState)(!1),j=Xe(a.a,m,2),O=j[0],v=j[1],x=Object(i.a)((function(){v(!1),o({}),b(!1)})),y=Object(i.a)((function(){return t("".concat(location.origin,"/api/v4/materials/pc_editor/folders?type=").concat(e,"&material_type=image")).then((function(e){var t,n=Object(ee.camelizeKeys)((null===(t=e.payload)||void 0===t?void 0:t.data)||{});return o(n),n}))}));return Object(l.useEffect)((function(){d||y().then((function(e){var t,n,a=null==e||null===(t=e.child)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id;p(a)})).catch((function(){v(!0)})).finally((function(){b(!0)}))}),[d,y]),{hasInited:d,isPageError:O,setIsPageError:v,reset:x,folders:c,getFoldersList:y,activeFolderId:h,setActiveFolderId:p}},tt=n(2199),nt=n(2991),at=n(1394),rt=n(2992),it=n(12),ct=n.n(it);function ot(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var lt=function(e){var t=e.type,n=e.className,i=e.inputShowName,c=void 0===i?"":i,o=e.resetInput,s=e.folderId,u=e.getFoldersList,d=Object(k.b)(),b=Object(l.useRef)(),g=Object(l.useState)(c),f=ot(a.a,g,2),h=f[0],p=f[1];return Object(r.b)("input",{ref:b,type:"text",className:ct()("MaterialLibrary-input-module",n),placeholder:"请输入文件名称",autoFocus:"autofocus",onChange:function(e){var t=e.target.value;p(t)},value:h,onBlur:function(){o&&o(""),"add"!==t&&h&&d("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(s),{method:"PUT",body:{name:h}}).then((function(){var e;null===(e=b.current)||void 0===e||e.blur(),u&&u()})).catch((function(e){var t,n,a;X.a.alert((null===(t=e.payload)||void 0===t?void 0:t.message)||(null===(n=e.payload)||void 0===n||null===(a=n.error)||void 0===a?void 0:a.message)||"网络错误，稍后重试吧!")}))},onKeyUp:function(e){var t;13===e.keyCode&&(null===(t=b.current)||void 0===t||t.blur())}})};lt.propTypes={inputShowName:o.a.string,resetInput:o.a.func};var st=lt;function ut(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var dt=function(e){return Object(r.b)(s.a,Object.assign({as:g.Flex,zaType:"Button",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",css:function(e){return{borderRadius:"12px",backgroundColor:e.colors.GBK99A,cursor:"pointer","&+&":{marginLeft:"4px"}}}},e))},bt=function(e){var t,n=e.folders,i=void 0===n?{}:n,c=e.activeFolderId,o=e.getFoldersList,s=e.folderClick,u=e.reset,d=Object(k.b)(),b=Object(l.useState)(""),f=ut(a.a,b,2),h=f[0],p=f[1],m=Object(l.useState)(""),j=ut(a.a,m,2),O=j[0],v=j[1],x=function(e,t){"nav-edit"===e?(p(t.id),v(t.name)):"nav-delete"===e&&X.a.confirm(Object(r.c)("div",{className:"MaterialLibrary-alert",children:[Object(r.b)("h2",{children:"是否删除已选择分类？"}),Object(r.b)("p",{children:"分类中的图片将归入未分类中"})]}),{text:{ok:"删除",cancel:"取消"}}).then((function(){d("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(t.id),{method:"DELETE",body:{delete_material:!1}}).then((function(e){var t,n;null!==(t=e.payload)&&void 0!==t&&t.success?(X.a.alert("已成功删除分组，该分组的图片已移动至「我的图片-未分类」"),u()):X.a.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")}))}),(function(){}))};return null!=i&&i.hidden?null:Object(r.c)("div",{className:"MaterialLibraryNav",children:[Object(r.c)("div",{className:"MaterialLibraryNav-nav",children:[Object(r.c)(g.Flex,{className:"MaterialLibraryNav-Mine",justifyContent:"space-between",alignItems:"center",children:[Object(r.c)(g.Flex,{justifyContent:"space-between",alignItems:"center",children:[Object(r.b)(tt.a,{className:"nav-icon"}),null==i?void 0:i.name]}),Object(r.b)("div",{className:"nav-num",children:null==i?void 0:i.materialCount})]}),null==i||null===(t=i.child)||void 0===t?void 0:t.map((function(e){return Object(r.c)(g.Flex,{className:ct()("MaterialLibraryNav-Folder",{active:c===e.id}),justifyContent:"space-between",alignItems:"center",onClick:function(){s(e.id)},children:[Object(r.c)(g.Flex,{justifyContent:"space-between",alignItems:"center",children:[Object(r.b)(nt.a,{className:"nav-icon"}),h!==e.id&&Object(r.b)("div",{className:"nav-name",children:e.name})]}),h!==e.id&&Object(r.b)("div",{className:ct()("nav-num",{"disable-hover":!e.supportEdit&&!e.supportDelete}),children:e.materialCount||0}),h!==e.id&&(e.supportEdit||e.supportDelete)&&Object(r.c)(g.Flex,{className:"nav-handle",children:[e.supportEdit&&Object(r.b)(dt,{zaText:"编辑",onClick:function(t){t.stopPropagation(),x("nav-edit",e)},children:Object(r.b)(at.a,{fill:"currentColor",size:10})}),e.supportDelete&&Object(r.b)(dt,{zaText:"删除",onClick:function(t){t.stopPropagation(),x("nav-delete",e)},children:Object(r.b)(Fe.a,{fill:"currentColor",size:10})})]}),h===e.id&&Object(r.b)(st,{folderId:e.id,inputShowName:O,getFoldersList:o,resetInput:function(e){p(e)}})]},e.id)}))]}),Object(r.c)(g.Flex,{className:"MaterialLibraryNav-Add",justifyContent:"space-between",alignItems:"center",onClick:function(){var e;(null==i||null===(e=i.child)||void 0===e?void 0:e.length)>15?X.a.alert("分组已达上限，请删除已有的分类后再行添加"):X.a.confirm(Object(r.c)("div",{className:"MaterialLibrary-alert",children:[Object(r.b)("h2",{children:"添加分类"}),Object(r.b)(st,{type:"add",className:"MaterialLibraryNav-input-module"})]}),{text:{ok:"添加",cancel:"取消"}}).then((function(){var e,t=null===(e=document.querySelector(".MaterialLibrary-input-module"))||void 0===e?void 0:e.value;d("".concat(location.origin,"/api/v4/materials/pc_editor/folders"),{method:"POST",body:{name:t,material_type:"image"}}).then((function(){o()})).catch((function(e){var t,n,a;X.a.alert((null===(t=e.payload)||void 0===t?void 0:t.message)||(null===(n=e.payload)||void 0===n||null===(a=n.error)||void 0===a?void 0:a.message)||"网络错误，稍后重试吧!")}))}),(function(){}))},children:[Object(r.b)(rt.a,{className:"nav-icon"}),"添加分类"]})]})};bt.propTypes={folders:o.a.object,getFoldersList:o.a.func,folderClick:o.a.func};var gt=bt,ft=["dataList","activeFolderId","folders","getFoldersList","insertImages"];function ht(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){o=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(o)throw i}}}}function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var mt=function(e){var t=e.isPageError,n=e.handleUploadImage,a=e.reset;return t?Object(r.b)(r.a,{children:Object(r.b)(C.a.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:a})}):Object(r.b)(Ke,{css:{marginTop:"-50px"},handleUploadImage:n})},jt=function(e){var t=e.dataList,n=e.activeFolderId,a=e.folders,i=e.getFoldersList,c=e.insertImages,o=Object(b.default)(e,ft),s=Object(k.b)(),u=(t||[]).filter((function(e){return!0===e.checked})),d=Object(l.useMemo)((function(){var e;return null==a||null===(e=a.child)||void 0===e?void 0:e.filter((function(e){return e.id!==n}))}),[a,n]);return Object(r.c)(g.Flex,Object.assign(Object.assign({css:{padding:"13px 20px"},justifyContent:u.length>0?"space-between":"flex-end"},o),{},{children:[u.length>0&&Object(r.b)(be,{onClick:function(){0!==u.length&&X.a.confirm(Object(r.c)("div",{className:"MaterialLibrary-alert",children:[Object(r.c)("h2",{children:["是否删除已选择共 ",u.length," 张图片？"]}),Object(r.b)("p",{children:"插入至内容中的图片不会受到影响"})]}),{text:{ok:"删除",cancel:"取消"}}).then((function(){var e="".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(n,"/materials");s(e,{method:"DELETE",body:{material_type:"image",folder_material_ids:u.map((function(e){return e.uniqueId}))}}).then((function(e){var t,n;null!==(t=e.payload)&&void 0!==t&&t.success?i():X.a.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")}))}),(function(){}))},children:"删除图片"}),Object(r.c)(g.Box,{children:[u.length>0&&(null==d?void 0:d.length)>0&&Object(r.b)(de,{css:{width:"86px"},onClick:function(){if(0!==u.length){var e=d[0].id;X.a.confirm(Object(r.c)("div",{className:"MaterialLibrary-alert",children:[Object(r.c)("h2",{children:["为已选择共 ",u.length," 张图片分类"]}),Object(r.b)(Ye.b,{buttonClassName:"MaterialLibraryContent-select",listClassName:"MaterialLibraryContent-option",value:n,onChange:function(t){e=t},children:d.map((function(e){var t=e.name,n=e.id;return Object(r.b)(Ye.a,{value:n,text:t,children:t},n)}))})]}),{text:{ok:"确定",cancel:"取消"}}).then((function(){s("".concat(location.origin,"/api/v4/materials/pc_editor/material-move"),{method:"POST",body:{folder_id:n,target_folder_id:e,folder_material_ids:u.map((function(e){return e.uniqueId}))}}).then((function(e){var t,n;null!==(t=e.payload)&&void 0!==t&&t.success?i():X.a.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")}))}),(function(){}))}},children:"移动"}),Object(r.b)(ue,{active:u.length>0,onClick:function(){c(fe(u))},zaText:"插入图片；图片数：".concat(u.length||0),children:"插入图片"})]})]}))},Ot=function(e){var t=e.activeFolderId,n=e.getFoldersList,a=e.folders,c=Object(k.b)(),o=Object(Te.useDispatch)(),s=ie({itemKey:"uniqueId"}),u=s.materialList,d=s.paging,b=s.isLoading,f=s.setIsLoading,h=s.hasInited,p=s.setHasInited,m=s.isDrained,j=s.isPageError,O=s.setIsPageError,v=s.selectAllChecked,x=s.toggleSelectAll,y=s.reset,I=s.handleResponseErrorData,C=s.handleResponseData,A=s.chooseImage,w=s.insertImages,S=!u.length,T=Object(i.a)((function(){return f(!0),O(!1),c((null==d?void 0:d.next)||Object(L.a)("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(t,"/materials"),{offset:null==u?void 0:u.length,limit:24}))})),E=Object(i.a)((function(){return T().then(C).catch((function(e){I(e.payload)}))})),B=function(e){var a=e.target.files;if(null!=a&&a.length)if((null==a?void 0:a.length)>100)X.a.alert("添加图片请不要超过 100 张哦~");else{var r,i=[],l=ht(a,!0);try{var s=function(){var e=r.value;Object(ke.b)({file:e,preset:ke.a.content}).then((function(){Object($e.a)(e).then((function(r){Object(Qe.a)(r).then((function(r){(i=i.concat({name:null==e?void 0:e.name,source:null==r?void 0:r.original_hash})).length===a.length&&function(e){c("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(t,"/materials"),{method:"POST",body:{material_type:"image",materials:e}}).then((function(e){var t,a;null!==(t=e.payload)&&void 0!==t&&t.success?n():X.a.alert((null===(a=e.payload)||void 0===a?void 0:a.message)||"网络错误，稍后重试吧！")})).catch((function(e){var t,n,a;X.a.alert((null===(t=e.payload)||void 0===t?void 0:t.message)||(null===(n=e.payload)||void 0===n||null===(a=n.error)||void 0===a?void 0:a.message)||"网络错误，稍后重试吧!")}))}(i)}))}))})).catch((function(e){o(Object(ze.h)(e.message||"图片上传未完成，请稍后发布","red"))}))};for(l.s();!(r=l.n()).done;)s()}catch(e){l.e(e)}finally{l.f()}}};Object(l.useEffect)((function(){!h&&t&&T().then(C).catch((function(e){I(e.payload,!0)})).finally((function(){p(!0)}))}),[h,p,t,T,C,I]);var z=S?!b&&Object(r.b)(mt,{handleUploadImage:B,isPageError:j,reset:y}):Object(r.c)(r.a,{children:[Object(r.b)(g.Box,{mt:"-36px",width:"100px",children:Object(r.b)(De,{handleUploadImage:B},u.length)}),Object(r.b)(K,{getContainer:function(e){return e},onLoad:E,isLoading:b,isDrained:m,css:{marginLeft:"-14px"},children:u.map((function(e,t){return Object(r.b)(P,{data:e,chooseImage:A,insertImages:w,isPrivate:!0},String([e.uniqueId,t]))}))}),Object(r.b)(jt,{dataList:u,folders:a,activeFolderId:t,getFoldersList:n,insertImages:w})]});return Object(r.c)(r.a,{children:[Object(r.b)(oe,{children:Object(r.b)($,{css:{marginLeft:"auto"},checked:v,onChange:x})}),h?z:Object(r.b)(le,{})]})},vt=function(e){var t,n=Object(I.default)({},e),a=et(p.PRIVATE),i=a.hasInited,c=a.getFoldersList,o=a.reset,l=a.isPageError,s=a.folders,u=a.activeFolderId,d=a.setActiveFolderId,b=null===(t=s.child)||void 0===t?void 0:t.find((function(e){return e.id===u})),f=l?Object(r.b)(mt,{isPageError:!0,reset:o}):Object(r.b)(Ot,Object.assign({folders:s,activeFolderId:u,getFoldersList:c},n),String([u,null==b?void 0:b.materialCount]));return Object(r.c)(g.Flex,{color:"GBL05A",css:{height:"530px",overflow:"hidden",fontSize:"12px"},children:[!l&&Object(r.b)(gt,{folders:s,activeFolderId:u,folderClick:function(e){u!==e&&d(e)},getFoldersList:c,reset:o}),Object(r.b)(g.Flex,Object.assign(Object.assign({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px",flex:1}},n),{},{children:i?f:Object(r.b)(le,{css:{marginTop:42}})}))]})},xt=["active"],yt=function(e){var t=e.active,n=Object(b.default)(e,xt);return Object(r.b)("button",Object.assign({color:"GBK03A",css:[{padding:"0 12px",fontSize:"12px",cursor:"pointer"},t&&{fontWeight:"bold"}]},n))},It=function(e){var t=e.tabType,n=e.tabChange;return Object(r.b)(g.Flex,{children:j.map((function(e){return Object(r.b)(yt,{active:t===e.type,onClick:function(){n(e.type)},children:e.name},e.type)}))})};It.propTypes={tabType:o.a.string,tabChange:o.a.func};var Ct=["dataList","insertImages"];function Lt(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var kt,At=function(e){var t=e.isPageError,n=e.keywordCatch,a=e.reset;return t?Object(r.b)(C.a.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:a}):Object(r.b)(C.a.EI1A,{image:"default",content:"没有找到".concat(n?"「"+n+"」":"","相关内容"),buttonText:"搜索其他内容",buttonOnClick:function(){var e;null===(e=document.querySelector(".materials_library_public_search"))||void 0===e||e.focus()}})},wt=function(e){var t=e.dataList,n=e.insertImages,a=Object(b.default)(e,Ct),i=(t||[]).filter((function(e){return!0===e.checked}));return Object(r.b)(g.Flex,Object.assign(Object.assign({css:{padding:"13px 20px"},justifyContent:"flex-end"},a),{},{children:Object(r.b)(ue,{active:i.length>0,onClick:function(){n(fe(i))},zaText:"插入图片；图片数：".concat(i.length||0),children:"插入图片"})}))},St=function(e){var t=e.keywordCatch,n=e.activeFolderId,a=ne(),c=a.sourceId,o=a.sourceType,s=Object(k.b)(),u=ie({itemKey:"uniqueId"}),d=u.materialList,b=u.paging,f=u.isLoading,h=u.setIsLoading,p=u.hasInited,m=u.setHasInited,j=u.isDrained,O=u.isPageError,v=u.setIsPageError,x=u.subTypeCatch,y=(u.handleSubTypeChange,u.selectAllChecked),I=u.toggleSelectAll,C=u.reset,A=u.handleResponseErrorData,w=u.handleResponseData,S=u.chooseImage,T=u.insertImages,E=!d.length,B=Object(i.a)((function(){return h(!0),v(!1),s((null==b?void 0:b.next)||Object(L.a)("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(n,"/search"),{offset:null==d?void 0:d.length,limit:24,keyword:t,source_type:o,source_id:c,sub_type:x}))})),z=Object(i.a)((function(){return B().then(w).catch((function(e){A(e.payload)}))}));Object(l.useEffect)((function(){!p&&n&&B().then(w).catch((function(e){A(e.payload,!0)})).finally((function(){m(!0)}))}),[p,n,m,B,w,A]);var N=E?!f&&Object(r.b)(At,{isPageError:O,keywordCatch:t,reset:C}):Object(r.c)(r.a,{children:[Object(r.b)(K,{getContainer:function(e){return e},onLoad:z,isLoading:f,isDrained:j,children:d.map((function(e,t){return Object(r.b)(P,{data:e,insertImages:T,chooseImage:S},String([e.uniqueId,t]))}))}),Object(r.b)(wt,{dataList:d,insertImages:T})]});return Object(r.c)(r.a,{children:[Object(r.c)(oe,{children:[Object(r.c)("div",{className:"MaterialLibrary-SearchTipsContainer",children:[!1,t&&!E&&!f&&!O&&Object(r.c)(g.Box,{color:"GBK03A",width:"200px",css:{margin:"0px 12px",fontSize:"12px"},children:["以下为「",t,"」相关搜索内容"]})]}),Object(r.b)($,{checked:y,onChange:I})]}),p?N:Object(r.b)(le,{})]})},Tt=function(e){var t=Object(I.default)({},e),n=Object(l.useState)(""),i=Lt(a.a,n,2),c=i[0],o=i[1],s=et(p.PUBLIC),u=s.hasInited,d=s.reset,b=s.isPageError,f=s.activeFolderId,h=b?Object(r.b)(At,{isPageError:!0,reset:d}):Object(r.b)(St,Object.assign({keywordCatch:c,activeFolderId:f},t),c);return Object(r.c)(r.a,{children:[Object(r.b)(V,{placeholder:"搜索网络素材库",onSearch:o}),Object(r.b)(g.Flex,Object.assign(Object.assign({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},t),{},{children:u?h:Object(r.b)(le,{css:{marginTop:42}})}))]})};function Et(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var Bt=(kt={},Object(d.a)(kt,p.LOCAL,Je),Object(d.a)(kt,p.EMOTICON,xe),Object(d.a)(kt,p.PUBLIC,Tt),Object(d.a)(kt,p.PRIVATE,vt),Object(d.a)(kt,p.LATEST,Le),kt),zt=function(e){var t=e.onClose,n=e.sourceType,i=e.sourceId,c=e.insertImage,o=e.maxImage,u=e.tabs,d=e.initImage,b=void 0===d?[]:d,g=Object(l.useState)(p.LOCAL),f=Et(a.a,g,2),h=f[0],m=f[1],j=Object(l.useState)(b),O=Et(a.a,j,2),v=O[0],x=O[1],I=Bt[h];return Object(l.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("drop",e,!1),document.addEventListener("dragover",e,!1),function(){document.removeEventListener("drop",e,!1),document.removeEventListener("dragover",e,!1)}}),[]),Object(r.b)(ae,{onClose:t,sourceType:n,sourceId:i,insertImage:c,setTabType:m,initLocalList:v,setInitLocalList:x,maxImage:o,children:Object(r.c)("div",{children:[Object(r.b)(y,{tabType:h,tabChange:m,tabs:u}),I&&Object(r.b)(s.b,{block:h,children:Object(r.b)(I,{})})]})})};zt.propTypes={sourceType:o.a.string,sourceId:o.a.number,onClose:o.a.func,insertImage:o.a.func};var Nt=zt;function Rt(e,t,n){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var a=t.length;return function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}(t,void 0!==n&&n<a?n:a)}return e(t,n)}var Ft=function(e,t){var n=e.sourceType,c=e.sourceId,o=e.insertImage,d=e.maxImage,b=e.tabs,g=e.initImage,f=Object(l.useState)(!1),h=Rt(a.a,f,2),p=h[0],m=h[1],j=Object(i.a)((function(){return m((function(e){return!e}))}));return Object(l.useImperativeHandle)(t,(function(){return{toggleShown:j}}),[j]),Object(r.b)(u.b,{css:{minWidth:"746px",".Modal-content":{margin:0,padding:0}},onClose:j,children:p&&Object(r.b)(s.b,{block:"MaterialLibrary",children:Object(r.b)(Nt,{onClose:j,sourceType:n,sourceId:c,insertImage:o,maxImage:d,tabs:b,initImage:g})})})};Ft.propType={sourceType:o.a.string.isRequired,sourceId:o.a.number.isRequired,insertImage:o.a.func.isRequired};t.a=Object(l.forwardRef)(Ft)},2448:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o}));var a=n(0),r=n.n(a),i=n(27),c=Object.assign;function o(e){return r.a.createElement(i.a,c(c({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:(t=e.className,"function"==typeof t?t():"ZDI ZDI--ArrowTrayUp24"+(t?" "+t:""))}),r.a.createElement("path",{d:"M6.534 7.213a.705.705 0 00-.117 1.016.769.769 0 001.054.113l3.778-2.914v10.36c0 .394.336.712.75.712.415 0 .75-.318.75-.711V5.423l3.786 2.919a.769.769 0 001.054-.113.705.705 0 00-.117-1.016l-4.308-3.32a1.914 1.914 0 00-2.322 0l-4.308 3.32zM4.503 15a.75.75 0 00-1.5 0v3.47c0 1.318 1.144 2.28 2.418 2.28h13.164c1.274 0 2.418-.962 2.418-2.28V15a.75.75 0 00-1.5 0v3.47c0 .371-.349.78-.918.78H5.421c-.57 0-.918-.409-.918-.78V15z",fillRule:"evenodd",clipRule:"evenodd"}));var t}function l(e){return r.a.createElement(o,c(c({},e),{className:function(){return"Zi Zi--Export"+(e.className?" "+e.className:"")}}))}function s(e){return r.a.createElement(o,c(c({},e),{className:function(){return"Zi Zi--UpLoad"+(e.className?" "+e.className:"")}}))}},2991:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),r=n.n(a),i=n(27),c=Object.assign;function o(e){return r.a.createElement(i.a,c(c({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:(t=e.className,"function"==typeof t?t():"ZDI ZDI--Folder24"+(t?" "+t:""))}),r.a.createElement("path",{d:"M4.415 5.632a.915.915 0 00-.915.915v10.52c0 .505.41.914.915.914h14.153c.505 0 .915-.41.915-.915V9.045a.915.915 0 00-.915-.915H12.14a2.415 2.415 0 01-1.853-.866L9.198 5.96a.915.915 0 00-.702-.328h-4.08zM2 6.547a2.415 2.415 0 012.415-2.415h4.081c.716 0 1.394.318 1.853.866l1.09 1.304a.915.915 0 00.701.328h6.428a2.415 2.415 0 012.415 2.415v8.021a2.415 2.415 0 01-2.415 2.415H4.415A2.415 2.415 0 012 17.066V6.547z",fillRule:"evenodd",clipRule:"evenodd"}),r.a.createElement("path",{d:"M5.25 11.5a.75.75 0 01.75-.75h10a.75.75 0 010 1.5H6a.75.75 0 01-.75-.75z",fillRule:"evenodd",clipRule:"evenodd"}));var t}function l(e){return r.a.createElement(o,c(c({},e),{className:function(){return"Zi Zi--Folder"+(e.className?" "+e.className:"")}}))}},2992:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n(0),r=n.n(a),i=n(27),c=Object.assign;function o(e){return r.a.createElement(i.a,c(c({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:(t=e.className,"function"==typeof t?t():"ZDI ZDI--FolderPlus24"+(t?" "+t:""))}),r.a.createElement("path",{d:"M4.415 5.632a.915.915 0 00-.915.915v10.52c0 .505.41.914.915.914h8.413a.75.75 0 010 1.5H4.415A2.415 2.415 0 012 17.066V6.547a2.415 2.415 0 012.415-2.415h4.081c.715 0 1.394.318 1.853.866l1.09 1.304a.915.915 0 00.701.328h6.428a2.415 2.415 0 012.415 2.415v1.954a.75.75 0 01-1.5 0V9.045a.915.915 0 00-.915-.915H12.14a2.415 2.415 0 01-1.853-.866L9.198 5.96a.915.915 0 00-.702-.328h-4.08z",fillRule:"evenodd",clipRule:"evenodd"}),r.a.createElement("path",{d:"M16.3 16.039a.75.75 0 000 1.5h2.1v2.1a.75.75 0 001.5 0v-2.1H22a.75.75 0 100-1.5h-2.1v-2.1a.75.75 0 00-1.5 0v2.1h-2.1z"}));var t}function l(e){return r.a.createElement(o,c(c({},e),{className:function(){return"ZDI ZDI--Folderplus24"+(e.className?" "+e.className:"")}}))}function s(e){return r.a.createElement(o,c(c({},e),{className:function(){return"Zi Zi--FolderPlus"+(e.className?" "+e.className:"")}}))}}}]);
//# sourceMappingURL=main.shared_07f9c5ed15818567070990e8e5640b7f38547915.3c407c259e77098f11a2.js.map